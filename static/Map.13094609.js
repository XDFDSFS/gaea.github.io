import{_ as I}from"./client-only.f8f24ce6.js";import{d as O,r as f,q as B,an as L,o as J,n as A,$,a as F,c as R,b as d,bg as S,g as V,w as W,t as q,e as H,M as b,p as U,l as j,m as G}from"./entry.9908bd26.js";import{a as K}from"./dashboard.86964a38.js";let c=null;const x=(o,s=500,u=!1)=>{if(c!==null&&clearTimeout(c),u){const p=!c;c=setTimeout(function(){c=null},s),p&&typeof o=="function"&&o()}else c=setTimeout(function(){typeof o=="function"&&o()},s)},C=o=>(U("data-v-c8651f2e"),o=o(),j(),o),P={class:"w-full h-full min-h-[250px] bg-[#0F0F0F] rounded-lg shadow-3d relative"},Q=["id"],X=C(()=>d("div",{class:"w-3 h-3 bg-[#30b60b] rounded-full glow-effect"},null,-1)),Y=C(()=>d("span",{class:"text-[#747576] text-sm leading-[14px]"},"Workers: ",-1)),Z={class:"text-[#747576] text-base leading-4"},ee=O({__name:"Map",props:{id:{default:"echartMap"},data:{default:()=>[]}},setup(o){const s=o,{$eChart:u}=b(),{$worldData:p}=b(),z=p;u.registerMap("world",z);const t=f(),m=f(!0),h=f(null),y=f(),k=e=>{const a=new Map,i=new Set,n=new Set;for(let r=0;r<e.length;r++){const l=e[r];a.has(l.country)||a.set(l.country,{name:l.country,itemStyle:{areaColor:"#866c50",borderColor:"#d9af80"}}),i.add(JSON.stringify({coords:[[l.longitude,l.latitude],[103.51,1.16]]})),n.add(JSON.stringify([l.longitude,l.latitude]))}const v=Array.from(i).map(r=>JSON.parse(r)),N=Array.from(n).map(r=>({value:JSON.parse(r)}));return{regionsData:Array.from(a.values()),linesData:v,effectScatterEnd:N}},E=B(()=>k(s.data)),M=e=>({type:"lines",zlevel:2,effect:{color:"#d9af80",show:!0,period:2,trailLength:.4,symbol:"pin",symbolSize:8},lineStyle:{width:1,opacity:1,curveness:.5,color:"rgba(255, 255, 255, 0.4)"},data:e}),_=e=>({type:"effectScatter",coordinateSystem:"geo",zlevel:1,showEffectOn:"render",symbolSize:8,rippleEffect:{number:4,period:4,scale:3,brushType:"stroke"},itemStyle:{color:"#d9af80"},data:e}),g=async()=>{t.value&&(t.value.dispose(),t.value=null);const e=document.getElementById(s.id);if(!e||e.clientWidth===0||e.clientHeight===0)return;t.value=u.init(e);const{regionsData:a,linesData:i,effectScatterEnd:n}=E.value,v={animation:!1,progressive:500,progressiveThreshold:3e3,geo:{type:"map",map:"world",zoom:1.2,roam:!0,scaleLimit:{min:1.2,max:3},itemStyle:{areaColor:"rgba(51, 51, 51,1)",borderColor:"rgba(51, 51, 51,1)",borderType:"dotted"},emphasis:{itemStyle:{areaColor:"#866c50"},label:{show:!1,color:"#fff"}},regions:a},series:[M(i),_([s.data.length>0?[103.51,1.16]:[]]),_(n)]};t.value.setOption(v)};L(()=>s.data,()=>{m.value&&x(g,300)},{deep:!0});const T=async()=>{try{const e=await K();e.code===200&&(y.value=e.data)}catch(e){console.error("error:",e)}},D=()=>{t.value&&t.value.resize()},w=()=>{t.value&&x(D(),300)};return J(async()=>{m.value=!0,await A(),T(),g(),window.addEventListener("resize",w)}),$(()=>{m.value=!1,t.value&&(t.value.dispose(),t.value=null),h.value&&clearTimeout(h.value),window.removeEventListener("resize",w)}),(e,a)=>{const i=I;return F(),R("div",P,[d("div",{id:e.id,class:"w-full h-full"},null,8,Q),a[0]||(S(-1),a[0]=d("div",{class:"w-fit absolute left-5 bottom-3 flex items-center space-x-1"},[X,Y,V(i,null,{default:W(()=>{var n;return[d("span",Z,q(((n=H(y))==null?void 0:n.devices_connected)||0),1)]}),_:1})]),S(1),a[0])])}}});const se=G(ee,[["__scopeId","data-v-c8651f2e"]]);export{se as default};
