import{b6 as ie,aj as $,b7 as ce,ai as C,aq as ae,b8 as ue,q as M,v as V,av as se,f as A,Z as fe,d as de,M as le,w as K,e as O,r as ve,s as z,N as pe}from"./entry.e22b88b6.js";import{i as me}from"./throttle.1c60ea09.js";var Ee=/\s/;function Te(e){for(var t=e.length;t--&&Ee.test(e.charAt(t)););return t}var he=/^\s+/;function ye(e){return e&&e.slice(0,Te(e)+1).replace(he,"")}var J=0/0,be=/^[-+]0x[0-9a-f]+$/i,Fe=/^0b[01]+$/i,ge=/^0o[0-7]+$/i,we=parseInt;function X(e){if(typeof e=="number")return e;if(ie(e))return J;if($(e)){var t=typeof e.valueOf=="function"?e.valueOf():e;e=$(t)?t+"":t}if(typeof e!="string")return e===0?e:+e;e=ye(e);var n=Fe.test(e);return n||ge.test(e)?we(e.slice(2),n?2:8):be.test(e)?J:+e}var Se=function(){return ce.Date.now()};const B=Se;var _e="Expected a function",Ce=Math.max,Pe=Math.min;function je(e,t,n){var s,r,a,f,u,m,E=0,P=!1,h=!1,F=!0;if(typeof e!="function")throw new TypeError(_e);t=X(t)||0,$(n)&&(P=!!n.leading,h="maxWait"in n,a=h?Ce(X(n.maxWait)||0,t):a,F="trailing"in n?!!n.trailing:F);function g(c){var p=s,T=r;return s=r=void 0,E=c,f=e.apply(T,p),f}function o(c){return E=c,u=setTimeout(d,t),P?g(c):f}function i(c){var p=c-m,T=c-E,S=t-p;return h?Pe(S,a-T):S}function l(c){var p=c-m,T=c-E;return m===void 0||p>=t||p<0||h&&T>=a}function d(){var c=B();if(l(c))return v(c);u=setTimeout(d,i(c))}function v(c){return u=void 0,F&&s?g(c):(s=r=void 0,f)}function L(){u!==void 0&&clearTimeout(u),E=0,s=m=r=u=void 0}function I(){return u===void 0?f:v(B())}function w(){var c=B(),p=l(c);if(s=arguments,r=this,m=c,p){if(u===void 0)return o(m);if(h)return clearTimeout(u),u=setTimeout(d,t),g(m)}return u===void 0&&(u=setTimeout(d,t)),f}return w.cancel=L,w.flush=I,w}const Le=(e,t)=>{if(!C)return!1;const n={undefined:"overflow",true:"overflow-y",false:"overflow-x"}[String(t)],s=ae(e,n);return["scroll","auto","overlay"].some(r=>s.includes(r))},qe=(e,t)=>{if(!C)return;let n=e;for(;n;){if([window,document,document.documentElement].includes(n))return window;if(Le(n,t))return n;n=n.parentNode}return n};let N;const ze=e=>{var t;if(!C)return 0;if(N!==void 0)return N;const n=document.createElement("div");n.className=`${e}-scrollbar__wrap`,n.style.visibility="hidden",n.style.width="100px",n.style.position="absolute",n.style.top="-9999px",document.body.appendChild(n);const s=n.offsetWidth;n.style.overflow="scroll";const r=document.createElement("div");r.style.width="100%",n.appendChild(r);const a=r.offsetWidth;return(t=n.parentNode)==null||t.removeChild(n),N=s-a,N};function Je(e,t){if(!C)return;if(!t){e.scrollTop=0;return}const n=[];let s=t.offsetParent;for(;s!==null&&e!==s&&e.contains(s);)n.push(s),s=s.offsetParent;const r=t.offsetTop+n.reduce((m,E)=>m+E.offsetTop,0),a=r+t.offsetHeight,f=e.scrollTop,u=f+e.clientHeight;r<f?e.scrollTop=r:a>u&&(e.scrollTop=a-e.clientHeight)}const Xe=e=>["",...ue].includes(e);let _=[];const Y=e=>{const t=e;t.key===se.esc&&_.forEach(n=>n(t))},Ie=e=>{M(()=>{_.length===0&&document.addEventListener("keydown",Y),C&&_.push(e)}),V(()=>{_=_.filter(t=>t!==e),_.length===0&&C&&document.removeEventListener("keydown",Y)})},D="focus-trap.focus-after-trapped",H="focus-trap.focus-after-released",Oe="focus-trap.focusout-prevented",Z={cancelable:!0,bubbles:!1},Ne={cancelable:!0,bubbles:!1},G="focusAfterTrapped",Q="focusAfterReleased",Re=Symbol("elFocusTrap"),j=A(),U=A(0),q=A(0);let R=0;const re=e=>{const t=[],n=document.createTreeWalker(e,NodeFilter.SHOW_ELEMENT,{acceptNode:s=>{const r=s.tagName==="INPUT"&&s.type==="hidden";return s.disabled||s.hidden||r?NodeFilter.FILTER_SKIP:s.tabIndex>=0||s===document.activeElement?NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_SKIP}});for(;n.nextNode();)t.push(n.currentNode);return t},ee=(e,t)=>{for(const n of e)if(!ke(n,t))return n},ke=(e,t)=>{if(getComputedStyle(e).visibility==="hidden")return!0;for(;e;){if(t&&e===t)return!1;if(getComputedStyle(e).display==="none")return!0;e=e.parentElement}return!1},xe=e=>{const t=re(e),n=ee(t,e),s=ee(t.reverse(),e);return[n,s]},Ae=e=>e instanceof HTMLInputElement&&"select"in e,b=(e,t)=>{if(e&&e.focus){const n=document.activeElement;e.focus({preventScroll:!0}),q.value=window.performance.now(),e!==n&&Ae(e)&&t&&e.select()}};function te(e,t){const n=[...e],s=e.indexOf(t);return s!==-1&&n.splice(s,1),n}const Ue=()=>{let e=[];return{push:s=>{const r=e[0];r&&s!==r&&r.pause(),e=te(e,s),e.unshift(s)},remove:s=>{var r,a;e=te(e,s),(a=(r=e[0])==null?void 0:r.resume)==null||a.call(r)}}},We=(e,t=!1)=>{const n=document.activeElement;for(const s of e)if(b(s,t),document.activeElement!==n)return},ne=Ue(),Ke=()=>U.value>q.value,k=()=>{j.value="pointer",U.value=window.performance.now()},oe=()=>{j.value="keyboard",U.value=window.performance.now()},Be=()=>(M(()=>{R===0&&(document.addEventListener("mousedown",k),document.addEventListener("touchstart",k),document.addEventListener("keydown",oe)),R++}),V(()=>{R--,R<=0&&(document.removeEventListener("mousedown",k),document.removeEventListener("touchstart",k),document.removeEventListener("keydown",oe))}),{focusReason:j,lastUserFocusTimestamp:U,lastAutomatedFocusTimestamp:q}),x=e=>new CustomEvent(Oe,{...Ne,detail:e}),De=de({name:"ElFocusTrap",inheritAttrs:!1,props:{loop:Boolean,trapped:Boolean,focusTrapEl:Object,focusStartEl:{type:[Object,String],default:"first"}},emits:[G,Q,"focusin","focusout","focusout-prevented","release-requested"],setup(e,{emit:t}){const n=A();let s,r;const{focusReason:a}=Be();Ie(o=>{e.trapped&&!f.paused&&t("release-requested",o)});const f={paused:!1,pause(){this.paused=!0},resume(){this.paused=!1}},u=o=>{if(!e.loop&&!e.trapped||f.paused)return;const{key:i,altKey:l,ctrlKey:d,metaKey:v,currentTarget:L,shiftKey:I}=o,{loop:w}=e,c=i===se.tab&&!l&&!d&&!v,p=document.activeElement;if(c&&p){const T=L,[S,W]=xe(T);if(S&&W){if(!I&&p===W){const y=x({focusReason:a.value});t("focusout-prevented",y),y.defaultPrevented||(o.preventDefault(),w&&b(S,!0))}else if(I&&[S,T].includes(p)){const y=x({focusReason:a.value});t("focusout-prevented",y),y.defaultPrevented||(o.preventDefault(),w&&b(W,!0))}}else if(p===T){const y=x({focusReason:a.value});t("focusout-prevented",y),y.defaultPrevented||o.preventDefault()}}};le(Re,{focusTrapRef:n,onKeydown:u}),K(()=>e.focusTrapEl,o=>{o&&(n.value=o)},{immediate:!0}),K([n],([o],[i])=>{o&&(o.addEventListener("keydown",u),o.addEventListener("focusin",P),o.addEventListener("focusout",h)),i&&(i.removeEventListener("keydown",u),i.removeEventListener("focusin",P),i.removeEventListener("focusout",h))});const m=o=>{t(G,o)},E=o=>t(Q,o),P=o=>{const i=O(n);if(!i)return;const l=o.target,d=o.relatedTarget,v=l&&i.contains(l);e.trapped||d&&i.contains(d)||(s=d),v&&t("focusin",o),!f.paused&&e.trapped&&(v?r=l:b(r,!0))},h=o=>{const i=O(n);if(!(f.paused||!i))if(e.trapped){const l=o.relatedTarget;!me(l)&&!i.contains(l)&&setTimeout(()=>{if(!f.paused&&e.trapped){const d=x({focusReason:a.value});t("focusout-prevented",d),d.defaultPrevented||b(r,!0)}},0)}else{const l=o.target;l&&i.contains(l)||t("focusout",o)}};async function F(){await z();const o=O(n);if(o){ne.push(f);const i=o.contains(document.activeElement)?s:document.activeElement;if(s=i,!o.contains(i)){const d=new Event(D,Z);o.addEventListener(D,m),o.dispatchEvent(d),d.defaultPrevented||z(()=>{let v=e.focusStartEl;pe(v)||(b(v),document.activeElement!==v&&(v="first")),v==="first"&&We(re(o),!0),(document.activeElement===i||v==="container")&&b(o)})}}}function g(){const o=O(n);if(o){o.removeEventListener(D,m);const i=new CustomEvent(H,{...Z,detail:{focusReason:a.value}});o.addEventListener(H,E),o.dispatchEvent(i),!i.defaultPrevented&&(a.value=="keyboard"||!Ke()||o.contains(document.activeElement))&&b(s??document.body),o.removeEventListener(H,E),ne.remove(f)}}return M(()=>{e.trapped&&F(),K(()=>e.trapped,o=>{o?F():g()})}),V(()=>{e.trapped&&g()}),{onKeydown:u}}});function He(e,t,n,s,r,a){return ve(e.$slots,"default",{handleKeydown:e.onKeydown})}var Ye=fe(De,[["render",He],["__file","/home/runner/work/element-plus/element-plus/packages/components/focus-trap/src/focus-trap.vue"]]);export{Ye as E,Re as F,qe as a,je as d,ze as g,Xe as i,Je as s};
