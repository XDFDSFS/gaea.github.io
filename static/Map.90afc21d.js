import{d as I,b9 as p,r as z,k as L,ab as A,o as B,n as F,O,a as N,c as R,b as d,ba as b,t as q,_ as P,p as V,i as W,I as $,j}from"./entry.db64a3d7.js";import{a as H}from"./dashboard.f04fbe31.js";import"./dict.b0433064.js";import"./user.4871772a.js";let i=null;const S=(a,s=500,l=!1)=>{if(i!==null&&clearTimeout(i),l){const t=!i;i=setTimeout(function(){i=null},s),t&&typeof a=="function"&&a()}else i=setTimeout(function(){typeof a=="function"&&a()},s)},x=a=>(V("data-v-8f68d72d"),a=a(),W(),a),U={class:"w-full h-full min-h-[250px] bg-[#0F0F0F] rounded-lg shadow-3d relative"},G=["id"],J=x(()=>d("div",{class:"w-3 h-3 bg-[#30b60b] rounded-full glow-effect"},null,-1)),K=x(()=>d("span",{class:"text-[#747576] text-sm leading-[14px]"},"Workers: ",-1)),Q={class:"text-[#747576] text-base leading-4"},X=I({__name:"Map",props:{id:{default:"echartMap"},data:{default:()=>[]}},setup(a){const s=a,{$eChart:l}=$(),t=p(),u=p(!0),m=z(null),v=p(),C=e=>{const o=new Map,n=[],f=[];for(let c=0;c<e.length;c++){const r=e[c];o.has(r.country)||o.set(r.country,{name:r.country,itemStyle:{areaColor:"#866c50",borderColor:"#d9af80"}}),n.push({coords:[[r.longitude,r.latitude],[103.51,1.16]]}),f.push({value:[r.longitude,r.latitude]})}return{regionsData:Array.from(o.values()),linesData:n,effectScatterEnd:f}},T=L(()=>C(s.data)),k=e=>({type:"lines",zlevel:2,effect:{color:"#d9af80",show:!0,period:2,trailLength:.4,symbol:"pin",symbolSize:8},lineStyle:{width:1,opacity:1,curveness:.5,color:"rgba(255, 255, 255, 0.4)"},data:e}),h=e=>({type:"effectScatter",coordinateSystem:"geo",showEffectOn:"render",symbolSize:8,rippleEffect:{number:4,period:4,scale:3,brushType:"stroke"},itemStyle:{color:"#d9af80"},data:e}),_=async()=>{t.value&&(t.value.dispose(),t.value=null);const e=document.getElementById(s.id);if(!e||e.clientWidth===0||e.clientHeight===0)return;t.value=l.init(e);const{regionsData:o,linesData:n,effectScatterEnd:f}=T.value,c={animation:!1,progressive:500,progressiveThreshold:3e3,geo:{type:"map",map:"world",zoom:1.2,roam:!0,scaleLimit:{min:1.2,max:3},itemStyle:{areaColor:"rgba(51, 51, 51,1)",borderColor:"rgba(51, 51, 51,1)",borderType:"dotted"},emphasis:{itemStyle:{areaColor:"#866c50"},label:{show:!1,color:"#fff"}},regions:o},series:[k(n),h([s.data.length>0?[103.51,1.16]:[]]),h(f)]};t.value.setOption(c)};A(()=>s.data,()=>{u.value&&S(_,300)},{deep:!0});const M=async()=>{try{const e=await H();e.code===200&&(v.value=e.data)}catch(e){console.error("error:",e)}},D=()=>{t.value&&t.value.resize()},y=()=>{t.value&&S(D(),300)};let g=0;const w=()=>{if(!u.value)return;const e=Date.now();e-g>100&&(g=e,requestIdleCallback(()=>{t.value&&t.value.setOption({series:[{type:"lines",effect:{trailLength:(Math.sin(e/1e3)+1)/2*.6+.2}}]})})),requestAnimationFrame(w)},E=async()=>{if(!l.getMap("world")){const{default:e}=await P(()=>import("./world.2e1df9a7.js"),[],import.meta.url);l.registerMap("world",e)}};return B(async()=>{u.value=!0,await E(),await F(),_(),M(),window.addEventListener("resize",y),requestAnimationFrame(w)}),O(()=>{u.value=!1,t.value&&(window.removeEventListener("resize",y),t.value.dispose(),t.value=null),m.value&&clearTimeout(m.value)}),(e,o)=>{var n;return N(),R("div",U,[d("div",{id:e.id,class:"w-full h-full"},null,8,G),o[0]||(b(-1),o[0]=d("div",{class:"w-fit absolute left-5 bottom-3 flex items-center space-x-1"},[J,K,d("span",Q,q(((n=v.value)==null?void 0:n.devices_connected)||0),1)]),b(1),o[0])])}}});const ae=j(X,[["__scopeId","data-v-8f68d72d"]]);export{ae as default};
